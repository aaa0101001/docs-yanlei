# 电商数仓V4.0

## 项目需求

1. 用户行为数据采集建：flume框架、kafk
2. 业务数据采集平台搭建sqoop框架
3. 数据仓库维度建模
4. 分析，**设备**、**会员**、**商品**、**地区**活动等电商核心主题，统计报表指标近100个
5. 采用**即席查询**工具，随时进行指标分析
6. 对**集群性能进行监控**，发生异常需要报警：钉钉报警、QQ报警
7. **元数据管理**：Hadoop，MySQL中数据，图形化页面展示
8. **质量监控**：数据异常变化，eg：交易额异常变化
9. **权限管理**

## 系统数据流程设计

1. 项目需求
2. 项目技术选型：
3. 框架版本选型（Apache、CDH、HDP）
4. 服务器：物理机 or 云主机
5. 如何确定集群规模（假设每台主机8T规模）

###  技术选型

- 技术选型主要考虑因素
  - 数据量大小：大：hdfs，小：MySQL
  - 业务需求：根据时效性选择不同框架，
    - 快：flink、Storm
    - 慢：hive、spark批处理
  - 行业内经验
  - 技术成熟度
  - 开发维护成本
  - 总成本预算
- 数据采集传输：**Flume**、**Kafka**、**Sqoop**、**Logstash**、DataX
- 数据存储：**MySQL**、**HDFS**、**HBase**、Redis、MongoDB
- 数据计算：**Hive**，**Tez**，**Spark**，Flink，Storm
- 数据查询：**Preso**，**kylin**，Impala，Druid，ClickHouse，Doris
- 数据可视化：**Echarts**、**Superset**、QuickBI、DataV
- 任务调度：**Azkaban**，Oozie，DolphinScheduler，Airflow
- 集群监控：**Zabbix**，Prometheus
- 元数据管理：**Atlas**
- 权限管理：**Ranger**，Sentry

### 框架版本选型

1. 如何选择Apache、CDH、HDP版本
   - ​		apache：运维麻烦，组件间兼容需要自己调研
   - cdh：国内最多使用，收费
   - hdp：开源，不如cdh稳定，使用较少
   - 2 3结合，cdp，收费
2. 云服务选择
   1. 阿里云的EMR，MaxCompute，DataWorks
   2. 亚马逊云EMR
   3. 腾讯云EMR
   4. 华为云EMR

### 服务器选型

1. 服务器物理机还是云主机

### 集群规模

1. 如何确认集群规模（假设：每台服务器8T磁盘，128G内存）
   1. 每天日活跃用户100万，每人一天100条：100万*100条=1亿条
   2. 每条日志1k左右，每天1亿条：1亿/1024/1024约等于100G
   3. 半年内不扩容服务器来算，100G*180天约等于18T
   4. 保存3副本：18T*3=54T
   5. 预留20%~30%Buf=57T/0.7=77T
   6. 十台
2. 数仓分层？数据采用压缩？需要重新再计算

### 集群资源规划设计

生产集群：运行生产任务

测试集群：上下前代码编写和测试

1. 生产集群
   1. 消耗内存的尽量分开
   2. 数据传输比较紧密的放在一起（Kafka、Zookeeper）
   3. 客户端尽量放在1到两台服务器上，方便外部访问
   4. 有依赖关系的尽量放在同一台服务器（Hive和Azkaban Executor）
2. 测试集群，一般三台，满足以上原则644、833

## 数据生成模块

### 目标数据

页面数据、事件数据、曝光数据、启动数据和错误数据

### 数据埋点

代码(前端、后端)埋点

可视化埋点

全埋点（第三方sdk：百度、神策）

### 埋点上传时机

- 产生一条发一条
- 页面离开统一发送【本次采用】

### 埋点数据日志结构

1. 普通页面埋点日志：所有事件、曝光信息、错误信息、公共信息{设备信息、地理位置、应用信息}
2. 启动日志



### 

